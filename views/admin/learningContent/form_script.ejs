<script type="text/javascript">

  $(document).ready(function () {

    $("#topics").select2({
      placeholder: "Select Topic",
      allowClear: false,
    });

    $("#subTopics").select2({
      placeholder: "Select Sub Topic",
      allowClear: false,
    });

    $("#grades").select2({
      placeholder: "Select Grade",
      allowClear: false,
    });

    $('#thumbnail').dropify({
      tpl: {
        message: '<div class="dropify-message"><span class="file-icon" /> <p>Drag & Drop here size should be</p><a class="d-inline-block mt-2 mb-3 theme-btn" href="javasript:void(0);">Select File</a><h6 class="mb-0 fn-12 text-dblue">Supported formates : JPEG, PNG, MP4</h6></div>',
      },
    });

    $('.select-video').dropify({
      tpl: {
        message: '<div class="dropify-message"><span class="file-icon" /> <p>Drag & Drop here size should be</p><a class="d-inline-block mt-2 mb-3 theme-btn" href="javasript:void(0);">Select File</a><h6 class="mb-0 fn-12 text-dblue">Select your preferred video type. (.mp4, YouTube, Vimeo etc.)</h6></div>',
      },
    });

    $('.select-attachments').dropify({
      tpl: {
        message: '<div class="dropify-message"><span class="file-icon" /> <p>Drag & Drop here size should be</p><a class="d-inline-block mt-2 mb-3 theme-btn" href="javasript:void(0);">+ Attachments</a><h6 class="mb-0 fn-12 text-dblue">Supported formates : (PDF, Excel)</h6></div>',
      },
    });

    $('.single-img').dropify({
      tpl: {
        message: '<div class="dropify-message"><img src="/images/frame.svg" alt="img"> <p>Drag & Drop here</p><h6 class="mb-0 mt-1 fn-12 text-dblue">Select your preferred video type. (JPEG, PNG, SVG, etc.)</h6></div>',
      },
    });

    // tinyMce Editor
    tinymce.init({
      selector: '.editer',
      height: 300,
      menubar: false,
      statusbar: false,
      plugins: [
        'advlist autolink lists link image charmap print preview anchor textcolor',
        'searchreplace visualblocks code fullscreen',
        'insertdatetime media table contextmenu paste code help wordcount'
      ],
      mobile: {
        theme: 'mobile'
      },
      toolbar: 'insert | undo redo |  formatselect | bold italic backcolor  | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help',
    });

  });

  function loadSubTopic(topicId) {
    $.ajax({
      type: "POST",
      url: '/learning-content/renderSubtopic',
      data: {
        id: topicId,
      },
      success: function (response) {
        $('#subTopics').empty();
        for (res of response) {
          var newOption = new Option(res.name, res._id, false, false);
          $('#subTopics').append(newOption).trigger('change');
        }
      },
    });
  }
  $('#topics').change(function () {
    let topicId = $(this).val();
    loadSubTopic(topicId);
  })


  // Form Stepper 
  jQuery(document).ready(function () {
    // click on next button
    jQuery('.form-wizard-next-btn').click(function () {
      var parentFieldset = jQuery(this).parents('.wizard-fieldset');
      var currentActiveStep = jQuery(this).parents('.form-wizard').find('.form-wizard-steps .active');
      var next = jQuery(this);
      var nextWizardStep = true;
      parentFieldset.find('.wizard-required').each(function () {
        var thisValue = jQuery(this).val();
        var thisType = jQuery(this).attr("type");

        if (thisValue == "") {
          if (thisType == 'file') {
            jQuery(this).parents(".dropify-wrapper").css("border-color", "red");
          }
          jQuery(this).siblings(".wizard-form-error").slideDown();
          nextWizardStep = false;
        }
        else {
          if (thisType == 'file') {
            jQuery(this).parents(".dropify-wrapper").css("border-color", "#4A4674");
          }
          jQuery(this).siblings(".wizard-form-error").slideUp();
        }
      });
      if (nextWizardStep) {
        next.parents('.wizard-fieldset').removeClass("show", "400");
        currentActiveStep.removeClass('active').addClass('activated').next().addClass('active', "400");
        next.parents('.wizard-fieldset').next('.wizard-fieldset').addClass("show", "400");
        jQuery(document).find('.wizard-fieldset').each(function () {
          if (jQuery(this).hasClass('show')) {
            var formAtrr = jQuery(this).attr('data-tab-content');
            jQuery(document).find('.form-wizard-steps .form-wizard-step-item').each(function () {
              if (jQuery(this).attr('data-attr') == formAtrr) {
                jQuery(this).addClass('active');
                var innerWidth = jQuery(this).innerWidth();
                var position = jQuery(this).position();
                jQuery(document).find('.form-wizard-step-move').css({ "left": position.left, "width": innerWidth });
              } else {
                jQuery(this).removeClass('active');
              }
            });
          }
        });
      }
    });
    //click on previous button

    //click on previous button
    jQuery('.form-wizard-previous-btn').click(function () {
      var counter = parseInt(jQuery(".wizard-counter").text());;
      var prev = jQuery(this);
      var currentActiveStep = jQuery(this).parents('.form-wizard').find('.form-wizard-steps .active');
      prev.parents('.wizard-fieldset').removeClass("show", "400");
      prev.parents('.wizard-fieldset').prev('.wizard-fieldset').addClass("show", "400");
      currentActiveStep.removeClass('active').prev().removeClass('activated').addClass('active', "400");
      jQuery(document).find('.wizard-fieldset').each(function () {
        if (jQuery(this).hasClass('show')) {
          var formAtrr = jQuery(this).attr('data-tab-content');
          jQuery(document).find('.form-wizard-steps .form-wizard-step-item').each(function () {
            if (jQuery(this).attr('data-attr') == formAtrr) {
              jQuery(this).addClass('active');
              var innerWidth = jQuery(this).innerWidth();
              var position = jQuery(this).position();
              jQuery(document).find('.form-wizard-step-move').css({ "left": position.left, "width": innerWidth });
            } else {
              jQuery(this).removeClass('active');
            }
          });
        }
      });
    });
    //click on form submit button
    jQuery(document).on("click", ".form-wizard .form-wizard-submit", function () {
      var parentFieldset = jQuery(this).parents('.wizard-fieldset');
      var currentActiveStep = jQuery(this).parents('.form-wizard').find('.form-wizard-steps .active');
      parentFieldset.find('.wizard-required').each(function () {
        var thisValue = jQuery(this).val();
        var thisType = jQuery(this).attr("type");

        if (thisValue == "") {
          if (thisType == 'file') {
            jQuery(this).parents(".dropify-wrapper").css("border-color", "red");
          }
          jQuery(this).siblings(".wizard-form-error").slideDown();
        }
        else {
          if (thisType == 'file') {
            jQuery(this).parents(".dropify-wrapper").css("border-color", "#4A4674");
          }
          jQuery(this).siblings(".wizard-form-error").slideUp();
        }
      });
    });
    // focus on input field check empty or not
    jQuery(".form-control").on('focus', function () {
      var tmpThis = jQuery(this).val();
      if (tmpThis == '') {
        jQuery(this).parent().addClass("focus-input");
      }
      else if (tmpThis != '') {
        jQuery(this).parent().addClass("focus-input");
      }
    }).on('blur', function () {
      var tmpThis = jQuery(this).val();
      var tmpType = jQuery(this).attr("type");

      if (tmpThis == '') {
        if (tmpType == 'file') {
          jQuery(this).parents(".dropify-wrapper").css("border-color", "red");
        }
        jQuery(this).parent().removeClass("focus-input");
        jQuery(this).siblings('.wizard-form-error').slideDown("3000");
      }
      else if (tmpThis != '') {
        if (tmpType == 'file') {
          jQuery(this).parents(".dropify-wrapper").css("border-color", "#4A4674");
        }
        jQuery(this).parent().addClass("focus-input");
        jQuery(this).siblings('.wizard-form-error').slideUp("3000");
      }
    });
  });

  $(document).ready(function () {
    $("body").tooltip({ selector: '[data-toggle=tooltip]' });
  });


  $(document).on("click", ".lesson-edit", function () {
    $(this).closest('.card-header').find('.editable-heading').focus();
  });

  $(document).on("click", ".lesson-expand", function () {
    let dataTarget = $(this).attr('data-target');
    $('.lesson-container').removeClass('show');
    //$(dataTarget).toggleClass('show');
  });

  $(document).on("click", ".informationSlide-add", function () {
    $('#slideAccordion').addClass('show');
  });

  $(document).on("click", ".slide-form-expand", function () {
    $('.slide-container').removeClass('show');
    let classes = $(this).attr('aria-controls');
    // $('#' + classes).addClass('show');
  });


  var $repeater = $('.repeater').repeater({
    initEmpty: false,
    show: function () {
      var index = $($(this), '.main-wizards-div"').index();
      var newLesson = 'lesson-' + index;
      $(this).find('.lesson-container').attr('id', newLesson);
      $(this).find('.lesson-expand').attr('data-target', '#' + newLesson).attr('aria-controls', newLesson);
      $(this).slideDown();
    },
    hide: function (deleteElement) {
      if (confirm("Are you sure you want to delete this element?")) {
        $(this).slideUp(deleteElement);
      }
    },
    ready: function (setIndexes) {
      // $dragAndDrop.on('drop', setIndexes);
    },
    isFirstItemUndeletable: true,

    repeaters: [{
      selector: '.inner-repeater',
      show: function () {
        var index = $($(this), '.wizards-div"').index();
        var newSlide = 'slide-' + index;
        $(this).find('.slide-container').attr('id', newSlide);
        $(this).find('.close-slide').attr('href', '#' + newSlide);
        $(this).find('.slide-form-expand').attr('data-target', '#' + newSlide).attr('aria-controls', newSlide);
        $(this).slideDown();
      },
      hide: function (deleteElement) {
        console.log('inner');
        console.log(deleteElement);
        $(this).slideUp(deleteElement);
        // if (confirm("Are you sure you want to delete this element?")) {
        //   $(this).slideUp(deleteElement);
        // }
      }
      // repeaters: [{ 
      //     selector: '.deep-inner-repeater' 
      // }]
    }]
  });

  $repeater.setList([
    // {
    //     'text-input': 'Clothing',
    //     'inner-list': []
    // }
  ]);



</script>