<div class="right_col" role="main">
  <div class="">

    <!-- page title starts -->
    <div class="page-title">
      <div class="title_left">
        <!-- <h3>Grades</h3> -->
      </div>

      <!-- <div class="title_right">
                  <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                    <div class="input-group">
                      <input type="text" class="form-control" placeholder="Search for...">
                      <span class="input-group-btn">
                        <button class="btn btn-default" type="button">Go!</button>
                      </span>
                    </div>
                  </div>
                </div> -->
    </div>
    <div class="clearfix"></div>
    <!-- page title end -->

    <!-- page content starts -->
    <div class="row">
      <div class="col-md-12 col-sm-12 ">
        <div class="x_panel">
          <div class="x_title">
            <h2>Grade<small>list</small></h2>
            <ul class="right-btns">
              <li> <a href="./grades/create" class="btn theme-btn" rel="tooltip" data-placement="top" title="Add">+
                  Add Grade</a>
              </li>
            </ul>
            <div class="clearfix"></div>
          </div>
          <div class="x_content">
            <div class="row">
              <div class="col-sm-12">
                <div class="card-box table-responsive">
                  <table id="datatable-responsive" class="table table-striped table-bordered dt-responsive nowrap"
                    cellspacing="0" width="100%">

                    <thead>
                      <tr>
                        <th>S.No</th>
                        <th>Grade</th>
                        <th>Status</th>
                        <th>Created At</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% let i=0; for(grade of data) { %>
                        <tr>
                          <td>
                            <%=++i%>
                          </td>
                          <td>
                            <%=grade.name%>
                          </td>
                          <td>
                            <label class="checkbox-inline">
                              <input type="checkbox" name="status" class="record-status"  data-toggle="toggle" data-on="Active" data-off="Deactive" data-onstyle="info" data-offstyle="danger" data-url="/grades/update-status" data-uid="<%=grade.id%>" id="toggle-trigger" <%=grade.status==1 ? 'checked' : '' %>>
                            </label>
                          </td>
                          <td>
                            <%=moment(grade.created_at).format('DD-MM-YYYY H:I:A')%>
                          </td>
                          <td>
                            <a class="btn btn-info m-1" href="/grades/edit/<%=grade.id%>" data-toggle="tooltip"
                              rel="tooltip" data-placement="top" title="Edit"><i class="fa fa-edit"></i></a>

                            <a href="javascript:void(0)" class="btn btn-info m-1"
                              onclick="confirmBeforeDeletion('/grades/destroy/<%=grade.id%>')"> <i class="fa fa-trash"
                                style="color: #ffffff;" data-toggle="tooltip" rel="tooltip" data-placement="top"title="Delete"></i></a>
                          </td>
                        </tr>
                        <% } %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- page content end -->
      </div>
    </div>
    <!-- page content end -->

  </div>
</div>

<script type="text/javascript">

  $(document).on('change click', '.record-status', function (event) {
    var action = $(this).attr("data-url");
    var recordUid = $(this).attr("data-uid");
    var status = $(this).prop('checked');
    Swal.fire({
      title: "Are you sure?",
      text: "Do you want to update status of this record?",
      icon: "question",
      showCancelButton: true,
      confirmButtonText: `Update`,
    })
      .then((result) => {
        // $('#pageloader').css('display', 'flex');
        if (!result.isDismissed) {
          $.ajax({
            type: "POST",
            url: action,
            data: {
              uid: recordUid,
              status: status,
            },
            success: function (response) {
                window.location.reload();
            },
            error: function (response) {
              let errorMessages = '';
              $.each(response.responseJSON.errors, function (key, value) {
                $.each(value, function (i, message) {
                  errorMessages += '<li>' + message + '</li>';
                });
              });
            },
            complete: function () {
              // $('#pageloader').css('display', 'none');
            }
          });
        } else {
          window.location.reload();
          return false;
        }
      });
  });
</script>